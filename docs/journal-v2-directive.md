# Journal Page v2 — Obsidian-Style Life OS

## What's Wrong With v1

The current journal page is a **structured form** (template sections, slugs, guided prompts). That's not how MJ actually journals. His Obsidian vault is:

1. **Markdown-native** — the daily note IS the document, not a form that generates markdown
2. **Freeform** — no rigid sections. The morning report has structure, but log entries, evening check-ins, and random thoughts are just appended throughout the day
3. **Collaborative** — both the human and the agent write into the SAME document. The agent fills in the morning report; the human adds log entries; the agent appends research findings
4. **Interconnected** — daily notes link to goals, projects, ideas, and tasks. Weekly reviews link to all 7 daily notes
5. **Simple** — no databases, no structured fields, no "energy dropdowns." Just text

## The Obsidian Vault Structure

```
Life OS.md              ← Hub page with links to everything
Goals.md                ← Active goals with status
Tasks.md                ← Running task list (checkbox format)
Ideas.md                ← Capture pad
daily/
  2026-02-16.md         ← One doc per day (morning report + log + evening check-in)
weekly/
  2026-W07.md           ← Weekly review linking to all 7 daily notes
projects/
  Sautai.md             ← Project-level notes
  Academy Watch.md
  NBHD United.md
templates/
  Daily Note.md         ← What a new day looks like (Morning Report / Log / Evening Check-in)
  Evening Check-in.md   ← Structured prompts for end-of-day reflection
  Morning Report.md     ← Agent-generated morning briefing format
  Weekly Review.md      ← End-of-week synthesis
  Monthly Review.md
  Yearly Review.md
  Goal Template.md
daily-briefings/
  2026-02-16-morning.md ← Standalone briefing (also embedded in daily note)
```

### Daily Note Template
```markdown
# {{date}}
[[{{yesterday}}]] | [[{{tomorrow}}]]
---
## Morning Report
*Generated by The Claw*

## Log
*Running transcript of the day — tasks, decisions, thoughts, research.*

## Evening Check-in
*Added at 16:30 JST*
```

The daily note starts near-empty. The agent fills in the morning report. Throughout the day, both human and agent append to the Log. In the evening, the human fills in the check-in (or dictates it conversationally and the agent structures it).

### Evening Check-in Template
```markdown
## What got done today?
## What didn't get done? Why?
## Plan for tomorrow (top 3)
## Overnight work for The Claw
## Blockers or decisions needed?
## Energy/mood (1-10)
```

### Weekly Review Template
Links to all 7 daily notes. Sections: Wins, What didn't work, Goal progress (per project), Budget check, Next week's focus, Energy/health, Ideas, Notes for the agent.

## What the NBHD Journal Page Should Be

### Core Principle
**The page IS the document.** Not a form that outputs a document. Users should see their markdown rendered beautifully, with the ability to edit sections inline. Think Notion, not Google Forms.

### Pages

#### 1. Today (`/journal/today`)
- Shows today's daily note as **rendered markdown**
- Date navigation (← yesterday | today | tomorrow →)
- The note auto-creates from the user's daily note template when first viewed
- **Three zones** matching the template:
  - **Morning Report** — agent-generated, read-only (rendered markdown with collapsible sections)
  - **Log** — both human and agent append here. Each entry is timestamped. "Quick add" input at the bottom (just a text box, hit enter to append)
  - **Evening Check-in** — guided prompts but freeform text. Can be filled via the app OR via chat (agent structures the response)
- **Raw markdown toggle** — for power users who want to see/edit the raw doc
- No dropdowns, no select fields, no structured data entry. Just text

#### 2. Goals (`/journal/goals`)
- Rendered view of Goals.md
- Each goal is a card: name, target, status, next milestone
- Inline editing
- "Add goal" uses the Goal Template

#### 3. Tasks (`/journal/tasks`)
- Rendered view of Tasks.md
- Checkbox list: Active / Waiting / Done sections
- Click to toggle done
- "Add task" appends to Active

#### 4. Ideas (`/journal/ideas`)
- Rendered view of Ideas.md
- Simple list: Active Ideas / Ice Box
- "Add idea" appends

#### 5. Weekly Review (`/journal/weekly`)
- Latest weekly review rendered
- Week navigation
- Links to each day's note
- Agent can auto-generate a draft review, human edits

#### 6. Projects (`/journal/projects`)
- List of project docs
- Each one renders as a page
- Agent can update project status

#### 7. Memory (`/journal/memory`)
- The agent's long-term memory about the user
- Rendered markdown, read-only for the human (agent curates this)
- Human can request edits via chat

### Navigation
Sidebar or tab bar:
```
Today | Goals | Tasks | Ideas | Weekly | Projects | Memory
```

### Data Model

Kill the template/section machinery. The models should be:

```python
class Document(models.Model):
    """One markdown document. Can be a daily note, goal, project, review, etc."""
    tenant = models.ForeignKey(Tenant, on_delete=models.CASCADE)
    kind = models.CharField(max_length=32, choices=[
        ("daily", "Daily Note"),
        ("weekly", "Weekly Review"),
        ("monthly", "Monthly Review"),
        ("goal", "Goal"),
        ("project", "Project"),
        ("tasks", "Tasks"),
        ("ideas", "Ideas"),
        ("memory", "Memory"),
    ])
    slug = models.CharField(max_length=128)  # e.g. "2026-02-16", "2026-W07", "sautai"
    title = models.CharField(max_length=256)
    markdown = models.TextField(default="")
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        unique_together = ["tenant", "kind", "slug"]
        ordering = ["-updated_at"]
```

One table. Everything is a document. The `kind` + `slug` combo identifies it. Daily notes use the date as slug. Weekly reviews use the ISO week. Projects use the project name.

### API

```
GET    /api/v1/journal/documents/?kind=daily&slug=2026-02-16
POST   /api/v1/journal/documents/                              # create new doc
PATCH  /api/v1/journal/documents/<id>/                         # update markdown
DELETE /api/v1/journal/documents/<id>/

# Convenience endpoints
GET    /api/v1/journal/today/           # get-or-create today's daily note
POST   /api/v1/journal/today/append/    # append text to today's log section
GET    /api/v1/journal/weekly/latest/    # latest weekly review
```

### Agent Runtime API

Same as before but simplified:
```
GET    /runtime/<tenant>/document/?kind=daily&slug=2026-02-16
POST   /runtime/<tenant>/document/append/    # append to a doc
PUT    /runtime/<tenant>/document/           # create or replace a doc
GET    /runtime/<tenant>/context/            # recent dailies + memory (session init)
```

### Templates

Templates are just markdown strings stored per tenant. When a new daily note is created, the template markdown is used as the initial content (with `{{date}}`, `{{yesterday}}`, `{{tomorrow}}` substituted). Users can customize templates via a settings page.

Default templates ship from the `templates/` directory in the codebase (matching the Obsidian templates above).

### Frontend Tech

- **Markdown rendering:** `react-markdown` or `@mdx-js/react` with syntax highlighting
- **Inline editing:** Click a section → contenteditable or textarea overlay → save on blur
- **Quick log input:** Simple text input at the bottom of the daily note, appends a timestamped entry
- **Checkbox interaction:** Click a checkbox in rendered markdown → toggles it in the source → saves

### What to Remove

- `NoteTemplate` model and all template/section machinery
- `DailyNoteSection` concept (sections are just markdown headings)
- `parse_daily_sections` / `set_daily_note_sections` / `materialize_sections_markdown`
- The entire template management page (`/journal/templates`)
- Structured serializers for journal entries (mood dropdown, energy selector, etc.)

### What to Keep

- `DailyNote` model (rename to `Document` or keep and add `kind`)
- `UserMemory` model (becomes `Document` with `kind="memory"`)
- The runtime API pattern (agent tools call runtime endpoints with internal auth)
- The `nbhd-journal-tools` plugin (update tool descriptions to match new API)

### Migration Path

1. Existing `DailyNote` rows → migrate to `Document(kind="daily")`
2. Existing `UserMemory` rows → migrate to `Document(kind="memory")`
3. Existing `JournalEntry` rows → convert to markdown and merge into daily notes
4. Drop `NoteTemplate`, `JournalEntry`, `WeeklyReview` tables after migration

## Summary

The journal should feel like **Obsidian in the browser** — a personal wiki where the agent is a collaborator. Not a structured form app. The markdown IS the interface. Keep it simple, keep it text-first, and let the agent do the heavy lifting of filling in content.
