# Developer Directive: Journaling Refactor â€” "Your OS"

## What This Actually Is

This is not a journal app. It's a **personal operating system** where a user and their AI agent collaborate through shared documents. Think of it like Obsidian's daily notes â€” but the AI agent is a co-author who fills in sections, responds to the user's notes, and maintains a knowledge base about them over time.

The user gets a set of **templates** that structure their day. The agent fills in its parts (morning report, research, evening summaries). The user fills in their parts (reflections, plans, mood). They write into the **same document**, and over time the agent learns what matters to the user by curating a long-term memory doc.

---

## How It Works In Practice (The Real System We're Replicating)

### The Daily Note

Every day, a new daily note is created from a template. Here's the default template:

```markdown
# {{date}}

---

## Morning Report
*Generated by your agent*

## Log
*Running transcript of the day â€” tasks, decisions, thoughts, research.*

## Evening Check-in
*Fill this in at the end of your day*
```

Here's what a **real completed day** looks like (both agent and user have contributed):

```markdown
# 2026-02-16 (Monday)

---

## Morning Report (05:30 JST)

### Overnight Work Completed

**1. âœ… Production Log Check**
Queried logs for last 12h â€” zero errors, zero crashes. Production stable.

**2. âœ… Cold Email Draft**
Contact: Ian Buckman, Academy Manager, Brighton & Hove Albion
Draft ready for your review (see below).

### Where Things Stand
- **Project A:** Production stable after Friday's hotfix.
- **Project B:** Timezone branch reviewed â€” ready for merge decision.

### Decisions You Need to Make
1. Merge the timezone branch? It's clean.
2. Review the cold email draft below. Send midday?

### Reminders
- ğŸ¤ Presentation â€” March 10 (22 days)
- ğŸ”‘ API key expires March 3 (15 days)

---

## Log

### 10:30 â€” MJ
Reviewed the timezone branch. Looks good. Merging now.

### 12:15 â€” Agent
Checked Gmail â€” nothing urgent. You have a 14:00 meeting with the design team.

### 14:45 â€” MJ
Meeting done. Need to send mockups by Wednesday. Adding that to tomorrow's plan.

### 18:00 â€” Agent
Ran the journaling refactor. Branch pushed to feature/journaling-refactor. 29 tests passing.

---

## Evening Check-in

### What got done today?
- Timezone branch merged âœ…
- Design meeting â€” mockups due Wednesday
- Journaling refactor kicked off
- Cold email reviewed but not sent (waiting for Monday)

### What didn't get done? Why?
- Gym. Stayed up too late last night.
  - *Agent note: This is the 3rd time this week. Sleep consistency would help.*

### Plan for tomorrow (top 3)
1. Send the cold email (aim for midday JST â†’ UK morning)
2. Mockup drafts for design team
3. Gym â€” no excuses

### Overnight work for the agent
- Review journaling refactor branch
- Check production logs
- Research competitor pricing

### Blockers or decisions needed?
- Need to decide on email domain (bhafc.co.uk vs brightonandhovealbion.com)

### Energy/mood (1-10)
- 6
```

**Key things to notice:**
1. The **Morning Report** is written entirely by the agent. It has a consistent structure: overnight work, status, decisions needed, reminders.
2. The **Log** is a running transcript where BOTH agent and user write timestamped entries throughout the day.
3. The **Evening Check-in** is primarily filled in by the user, but the agent can add inline comments (see the "Agent note" in the example).
4. This is ONE markdown document. Not separate database rows. One growing, collaborative document per day.

### The Evening Check-in Template (Standalone)

When the user fills in their evening check-in, they work from this structure:

```markdown
## What got done today?
- 

## What didn't get done? Why?
- 

## Plan for tomorrow (top 3)
1. 
2. 
3. 

## Overnight work for the agent
- 

## Blockers or decisions needed?
- 

## Energy/mood (1-10)
- 
```

### The Morning Report Template (Agent-Generated)

The agent fills this in automatically each morning:

```markdown
## Morning Report â€” {{date}}

### Overnight Work Completed
- 

### Where Things Stand
- 

### Decisions You Need to Make
- 

### Reminders
- 

### Today's Priorities
1. 
2. 
3. 
```

### Other Templates

**Weekly Review:**
```markdown
## ğŸ† Wins this week
- 

## âŒ What didn't work?
- 

## ğŸ¯ Goal progress
- **Project A:** 
- **Project B:** 

## ğŸ“… Next week's focus
1. 
2. 
3. 

## ğŸ’ª Energy / health check
- 

## ğŸ’¡ Ideas to explore
- 

## ğŸ“ Notes for the agent
- 
```

**Monthly Review:**
```markdown
## Last month summary
### Major accomplishments
- 

### Lessons learned
- 

## Keep / Stop / Start
- **Keep doing:** 
- **Stop doing:** 
- **Start doing:** 

## ğŸ“‹ Project status
- **Active:** 
- **Paused:** 
- **Archived:** 

## ğŸ¯ This month's theme/focus
- 

## ğŸ“ Notes for the agent
- 
```

**Goal Template:**
```markdown
# Goal: [Goal Name]

**Target:** [Specific, measurable outcome]
**Why:** [1-2 sentences on motivation]
**Due:** [Target date]

## Short-term subgoals
- [ ] Subgoal 1 â€” Due: [Date]
- [ ] Subgoal 2 â€” Due: [Date]

## Current status
[Where you are right now]

## Next milestone
[What success looks like in the next 2-4 weeks]

## Blockers
[Anything in the way]
```

### Long-Term Memory

Separately from daily notes, the agent maintains a **single curated document per user** (like a personal knowledge base). The agent periodically reviews daily notes and promotes important stuff here:

```markdown
# Memory

## Preferences
- Prefers morning meetings
- Energy peaks around 10am
- Likes detailed code reviews, not surface-level

## Goals
- Launch chef platform by March
- Exercise 3x per week

## Decisions
- Using PostgreSQL for all databases
- No Stripe until chef verification complete

## Lessons Learned
- Sleep consistency is the highest-leverage health fix
- Don't push to main without explicit approval

## People & Context
- Works at a Japanese company in cybersecurity
- Wife + daughter (4.5 years old)
- Osaka, Japan â€” JST timezone
```

This is NOT the daily note. This is a separate document the agent curates over time. The user can read and edit it too.

---

## Architecture

### Storage: Markdown in the Database

**Models** (already built on `feature/journaling-refactor`):

```python
class DailyNote(models.Model):
    tenant = models.ForeignKey('tenants.Tenant', on_delete=models.CASCADE)
    date = models.DateField()
    markdown = models.TextField(default='')  # The entire day's document
    
    class Meta:
        unique_together = ['tenant', 'date']

class UserMemory(models.Model):
    tenant = models.OneToOneField('tenants.Tenant', on_delete=models.CASCADE)
    markdown = models.TextField(default='')  # The curated memory document
```

One markdown document per user per day. One memory document per user total.

### Templates: Stored Per-Tenant

We need a new model to store the user's templates:

```python
class NoteTemplate(models.Model):
    """User-customizable templates. Seeded with defaults on signup."""
    tenant = models.ForeignKey('tenants.Tenant', on_delete=models.CASCADE, related_name='note_templates')
    slug = models.SlugField()  # 'daily-note', 'evening-checkin', 'weekly-review', 'monthly-review', 'goal'
    name = models.CharField(max_length=100)  # Display name
    markdown = models.TextField()  # Template content with {{date}} etc. placeholders
    is_active = models.BooleanField(default=True)
    sort_order = models.IntegerField(default=0)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        unique_together = ['tenant', 'slug']
        ordering = ['sort_order']
```

On tenant creation, seed default templates (the ones shown above). Users can edit these to customize their OS.

### API: Two Audiences

**User-facing (frontend, JWT auth):**

The frontend does NOT show raw markdown. It renders it into a friendly UI. But the API returns structured data parsed from the markdown.

`GET /api/v1/journal/daily/<date>/`
```json
{
  "date": "2026-02-16",
  "sections": [
    {
      "heading": "Morning Report (05:30 JST)",
      "level": 2,
      "author": "agent",
      "content_html": "<h3>Overnight Work Completed</h3><p><strong>1. âœ… Production stable</strong>...</p>",
      "content_markdown": "### Overnight Work Completed\n\n**1. âœ… Production stable**..."
    },
    {
      "heading": "Log",
      "level": 2,
      "author": "mixed",
      "entries": [
        { "time": "10:30", "author": "human", "content": "Reviewed the timezone branch..." },
        { "time": "12:15", "author": "agent", "content": "Checked Gmail â€” nothing urgent..." }
      ]
    },
    {
      "heading": "Evening Check-in",
      "level": 2, 
      "author": "human",
      "content_html": "<h3>What got done today?</h3><ul><li>Timezone branch merged âœ…</li>...</ul>",
      "content_markdown": "### What got done today?\n- Timezone branch merged âœ…\n..."
    }
  ]
}
```

`POST /api/v1/journal/daily/<date>/log/`
Appends a log entry:
```json
{ "text": "Reviewed the timezone branch. Looks good.", "mood": "ğŸ˜Š", "energy": 7 }
```

`PUT /api/v1/journal/daily/<date>/evening-checkin/`
Saves the evening check-in section:
```json
{
  "what_got_done": ["Timezone branch merged", "Design meeting"],
  "what_didnt": ["Gym â€” stayed up too late"],
  "plan_tomorrow": ["Send cold email", "Mockup drafts", "Gym"],
  "overnight_work": ["Review journaling branch", "Check production logs"],
  "blockers": ["Need to decide on email domain"],
  "energy_mood": 6
}
```
This gets serialized into the Evening Check-in markdown section and appended/replaced in the daily note.

`GET /api/v1/journal/templates/`
Returns the user's templates (for customization).

`PUT /api/v1/journal/templates/<slug>/`
Update a template's markdown.

`GET /api/v1/journal/memory/`
Returns the long-term memory document.

`PUT /api/v1/journal/memory/`
Updates the long-term memory document.

**Runtime/Agent (internal auth, already built):**
- `GET runtime/<tenant>/daily-note/?date=YYYY-MM-DD` â€” raw markdown
- `POST runtime/<tenant>/daily-note/append/` â€” append raw markdown
- `GET runtime/<tenant>/long-term-memory/` â€” raw markdown
- `PUT runtime/<tenant>/long-term-memory/` â€” replace memory doc
- `GET runtime/<tenant>/journal-context/` â€” last 7 days + memory (for agent session init)

---

## Frontend: What to Build

### Stack
- Next.js 14 (App Router), React 18, TanStack Query v5, Tailwind CSS 3
- Existing components: `SectionCard`, `SectionCardSkeleton`, `StatusPill`, `AppShell`

### Page 1: Daily Note (`frontend/app/page.tsx`)

This is the main page. It shows today's daily note rendered as a series of cards/sections.

**Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â—€  Monday, February 16  â–¶    [Today]   â”‚  â† Date picker
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  â”Œâ”€ Morning Report â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– Generated at 05:30 JST          â”‚  â”‚  â† Agent section, distinct bg
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Overnight Work Completed            â”‚  â”‚
â”‚  â”‚ âœ… Production stable â€” zero errors  â”‚  â”‚
â”‚  â”‚ âœ… Cold email drafted               â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Decisions You Need to Make          â”‚  â”‚
â”‚  â”‚ 1. Merge timezone branch?           â”‚  â”‚
â”‚  â”‚ 2. Review cold email â€” send midday? â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Reminders                           â”‚  â”‚
â”‚  â”‚ ğŸ¤ Presentation â€” March 10 (22d)   â”‚  â”‚
â”‚  â”‚ ğŸ”‘ API key â€” March 3 (15d)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  10:30  ğŸ‘¤ MJ                      â”‚  â”‚
â”‚  â”‚  Reviewed timezone branch. Merging. â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  12:15  ğŸ¤– Agent                   â”‚  â”‚  â† Agent entries tinted differently
â”‚  â”‚  Gmail clear. Meeting at 14:00.    â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  14:45  ğŸ‘¤ MJ                      â”‚  â”‚
â”‚  â”‚  Meeting done. Mockups by Wed.     â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ What's happening?       [+]  â”‚   â”‚  â”‚  â† Quick add input
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚ [ğŸ˜Š Mood] [âš¡ Energy]              â”‚  â”‚  â† Optional, collapsed
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Evening Check-in â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸŒ™ Fill this in at end of day      â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ What got done today?                â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ Timezone branch merged     â”‚   â”‚  â”‚  â† Bullet list input
â”‚  â”‚ â”‚ â€¢ Design meeting             â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ [+ Add item]                 â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ What didn't get done?              â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ Gym â€” stayed up too late   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ [+ Add item]                 â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Plan for tomorrow (top 3)          â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ 1. Send cold email           â”‚   â”‚  â”‚  â† Numbered list input
â”‚  â”‚ â”‚ 2. Mockup drafts             â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ 3. Gym                       â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Overnight work for your agent      â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ Review journaling branch   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ [+ Add item]                 â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Blockers?                          â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ â€¢ Email domain decision      â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚ Energy/Mood                        â”‚  â”‚
â”‚  â”‚ [ğŸ˜ ğŸ˜Š ğŸ˜¤ ğŸ˜´ ğŸ”¥] âš¡ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 6   â”‚  â”‚  â† Emoji picker + slider
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚          [Save Check-in]           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Behavior:**
- **On load:** Fetch today's daily note. If none exists, create one from the user's daily note template.
- **Morning Report section:** Read-only for the user. Rendered from the agent's markdown. Agent fills this via the runtime API. Visually distinct (subtle blue/gray tint, ğŸ¤– icon).
- **Log section:** Timeline of entries. Both human and agent entries. Human entries have an edit button. Agent entries are read-only. Quick-add input at the bottom for the user to append entries.
- **Evening Check-in section:** Interactive form that maps to the template structure. User fills in fields, clicks Save, and it serializes to markdown and updates the document. If already filled in, shows the saved content with an "Edit" button.
- **Date navigation:** Browse to previous days. Past days are fully read-only (no add/edit).
- **Empty state for new day:** Shows the template sections with placeholder text.

### Page 2: Memory (`frontend/app/memory/page.tsx`)

Shows the agent's curated knowledge about the user.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  What Your Agent Knows About You      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Your agent reviews your daily notes     â”‚
â”‚  and builds this over time. You can      â”‚
â”‚  edit anything here.                     â”‚
â”‚                                          â”‚
â”‚  â”€â”€ Preferences â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ Prefers morning meetings              â”‚
â”‚  â€¢ Energy peaks around 10am              â”‚
â”‚                                          â”‚
â”‚  â”€â”€ Goals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ Launch platform by March              â”‚
â”‚  â€¢ Exercise 3x per week                  â”‚
â”‚                                          â”‚
â”‚  â”€â”€ Lessons Learned â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ Sleep consistency matters most        â”‚
â”‚                                          â”‚
â”‚                              [Edit]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Renders markdown as formatted HTML
- Edit button opens a textarea (or simple rich text editor) with the raw markdown
- Save calls `PUT /api/v1/journal/memory/`
- Empty state: "Your agent hasn't built any memories yet."

### Page 3: Templates (`frontend/app/templates/page.tsx`)

Where users customize their OS.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ Your Templates                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  These templates shape your daily        â”‚
â”‚  workflow. Edit them to match how you    â”‚
â”‚  want to work.                           â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Daily Note â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ The foundation of your day.        â”‚  â”‚
â”‚  â”‚ Created each morning.              â”‚  â”‚
â”‚  â”‚                         [Edit] ğŸ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Evening Check-in â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ End-of-day reflection prompts.     â”‚  â”‚
â”‚  â”‚                         [Edit] ğŸ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Weekly Review â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Review your week every Sunday.     â”‚  â”‚
â”‚  â”‚                         [Edit] ğŸ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Goal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Track specific goals over time.    â”‚  â”‚
â”‚  â”‚                         [Edit] ğŸ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  [Reset to defaults]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Each template shows a preview and an edit button
- Edit opens a markdown editor (textarea is fine, power users will appreciate raw markdown control)
- Templates use `{{date}}`, `{{yesterday}}`, `{{tomorrow}}` placeholders

### Navigation Update

```typescript
const navItems = [
  { href: "/", label: "Today" },           // Daily note (default to today)
  { href: "/memory", label: "Memory" },     // Agent's knowledge base
  { href: "/templates", label: "Templates" }, // Customize your OS
  { href: "/settings", label: "Settings" },  // Account, integrations, billing
];
```

---

## Backend Changes Needed

### New Model: `NoteTemplate`

Add to `apps/journal/models.py`:

```python
class NoteTemplate(models.Model):
    tenant = models.ForeignKey('tenants.Tenant', on_delete=models.CASCADE, related_name='note_templates')
    slug = models.SlugField(max_length=50)
    name = models.CharField(max_length=100)
    markdown = models.TextField()
    is_active = models.BooleanField(default=True)
    sort_order = models.IntegerField(default=0)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        unique_together = ['tenant', 'slug']
        ordering = ['sort_order']
        db_table = 'note_templates'
```

### Seed Default Templates

Create a utility function (e.g., `apps/journal/template_defaults.py`) that seeds default templates for a new tenant. Call it during tenant provisioning. The defaults are the templates listed in the "How It Works" section above:
- `daily-note` â€” Daily Note
- `evening-checkin` â€” Evening Check-in
- `morning-report` â€” Morning Report (agent reference)
- `weekly-review` â€” Weekly Review
- `monthly-review` â€” Monthly Review
- `goal` â€” Goal

### New API Endpoints

`GET /api/v1/journal/templates/` â€” list user's templates
`GET /api/v1/journal/templates/<slug>/` â€” get one template
`PUT /api/v1/journal/templates/<slug>/` â€” update template markdown
`POST /api/v1/journal/templates/reset/` â€” reset all to defaults

### Update Daily Note Creation

When `GET /api/v1/journal/daily/<date>/` is called and no `DailyNote` exists for that date:
1. Fetch the user's `daily-note` template
2. Replace `{{date}}` with the actual date, `{{yesterday}}`/`{{tomorrow}}` with adjacent dates
3. Create the `DailyNote` with that rendered markdown
4. Return the parsed sections

### Update `md_utils.py`

The current parser splits on `## HH:MM â€” Author` headers. It needs to ALSO handle section-based parsing (splitting on `## Section Name` headers like "Morning Report", "Log", "Evening Check-in"). The daily note format uses section headers, not just timestamped entries.

Add:
```python
def parse_daily_note_sections(markdown: str) -> list[dict]:
    """Parse daily note into top-level sections (## headers).
    
    Returns list of:
    {
        "heading": "Morning Report (05:30 JST)",
        "level": 2,
        "content_markdown": "### Overnight Work...",
        "entries": [...] or None  # Only for Log section (has timestamped entries)
    }
    """
```

The Log section contains timestamped entries (`### HH:MM â€” Author`). Other sections are rendered as-is from markdown.

### Evening Check-in Endpoint

`PUT /api/v1/journal/daily/<date>/evening-checkin/` accepts structured data and serializes it into the Evening Check-in section of the daily note markdown:

```json
{
  "what_got_done": ["item1", "item2"],
  "what_didnt": ["item1"],
  "plan_tomorrow": ["item1", "item2", "item3"],
  "overnight_work": ["item1"],
  "blockers": ["item1"],
  "energy_mood": 6
}
```

This replaces the `## Evening Check-in` section in the markdown. Add a serializer/parser for this in `md_utils.py`.

---

## Files to Create

### Backend:
- `apps/journal/template_defaults.py` â€” default template content + seeding function
- New migration for `NoteTemplate` model

### Frontend:
- `frontend/app/memory/page.tsx` â€” Memory page
- `frontend/app/templates/page.tsx` â€” Templates customization page
- `frontend/components/journal/daily-note-view.tsx` â€” Main daily note renderer
- `frontend/components/journal/section-card.tsx` â€” Renders a section (Morning Report, Log, Evening Check-in)
- `frontend/components/journal/log-timeline.tsx` â€” Log section with timestamped entries
- `frontend/components/journal/log-entry.tsx` â€” Single log entry (human vs agent styling)
- `frontend/components/journal/log-input.tsx` â€” Quick-add input for log entries
- `frontend/components/journal/evening-checkin-form.tsx` â€” Interactive evening check-in form
- `frontend/components/journal/date-nav.tsx` â€” Date navigation header
- `frontend/components/journal/mood-energy.tsx` â€” Mood emoji picker + energy slider

## Files to Modify

### Backend:
- `apps/journal/models.py` â€” Add `NoteTemplate` model
- `apps/journal/md_utils.py` â€” Add section-based parser, evening check-in serializer
- `apps/journal/views.py` â€” Add template endpoints, evening check-in endpoint, update daily note GET to use sections
- `apps/journal/urls.py` â€” New routes
- `apps/journal/serializers.py` â€” New serializers for templates, evening check-in
- `apps/journal/tests.py` â€” Tests for all new functionality
- Tenant provisioning code â€” seed default templates on signup

### Frontend:
- `frontend/app/page.tsx` â€” Replace entirely with daily note view
- `frontend/components/app-shell.tsx` â€” Update nav items
- `frontend/lib/types.ts` â€” New types for sections, templates, memory
- `frontend/lib/api.ts` â€” New API functions
- `frontend/lib/queries.ts` â€” New TanStack Query hooks

## Files NOT to Modify
- `apps/journal/models.py` existing models (`JournalEntry`, `WeeklyReview`) â€” leave them, deprecate later
- `apps/integrations/runtime_views.py` â€” Runtime API is correct as-is
- Any existing migration files

---

## Design Guidelines

- **Mobile-first.** This will primarily be used on phones.
- **Agent content:** Subtle tinted background (e.g., `bg-blue-50/50`) with ğŸ¤– icon. Clearly distinct from user content.
- **User content:** Default white background with ğŸ‘¤ icon.
- **Morning Report:** Rendered as rich formatted content (the agent writes full markdown with headers, bold, lists). Read-only.
- **Log entries:** Chat-like timeline. Simple cards with time + author + content.
- **Evening Check-in:** Interactive form with list inputs (add/remove items), emoji picker for mood, slider for energy. NOT a textarea â€” structured inputs that serialize to markdown.
- **Memory page:** Rendered markdown with an edit toggle.
- **Templates page:** Markdown editor (textarea). Power user feature â€” keep it simple.
- Use existing Tailwind patterns from the codebase (`SectionCard`, `rounded-panel`, `border-ink/15`, etc.).

---

## Git Instructions

- All work on branch `feature/journaling-refactor`
- Commit with clear messages
- Do NOT merge to main
- Do NOT modify files outside the scope listed above
